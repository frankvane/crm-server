{
    "sourceFile": "services/rbac.service.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1745881501039,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1745881537060,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,28 +4,34 @@\n   async checkPermission(userId, requiredPermission) {\r\n     try {\r\n       // 获取用户及其角色和权限\r\n       const user = await User.findByPk(userId, {\r\n-        include: [{\r\n-          model: Role,\r\n-          include: [{\r\n-            model: Permission\r\n-          }]\r\n-        }]\r\n+        include: [\r\n+          {\r\n+            model: Role,\r\n+            include: [\r\n+              {\r\n+                model: Permission,\r\n+              },\r\n+            ],\r\n+          },\r\n+        ],\r\n       });\r\n \r\n       if (!user) {\r\n         return false;\r\n       }\r\n \r\n       // 检查用户的所有角色中是否有包含所需权限的\r\n-      return user.Roles.some(role => \r\n-        role.Permissions.some(permission => permission.name === requiredPermission)\r\n+      return user.Roles.some((role) =>\r\n+        role.Permissions.some(\r\n+          (permission) => permission.name === requiredPermission\r\n+        )\r\n       );\r\n     } catch (error) {\r\n       console.error(\"Error checking permission:\", error);\r\n       return false;\r\n     }\r\n   }\r\n }\r\n \r\n-module.exports = new RBACService(); \r\n+module.exports = new RBACService();\r\n"
                },
                {
                    "date": 1746064227253,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,11 +7,13 @@\n       const user = await User.findByPk(userId, {\r\n         include: [\r\n           {\r\n             model: Role,\r\n+            as: \"roles\", // 添加明确的别名\r\n             include: [\r\n               {\r\n                 model: Permission,\r\n+                as: \"permissions\", // 添加明确的别名\r\n               },\r\n             ],\r\n           },\r\n         ],\r\n@@ -21,10 +23,10 @@\n         return false;\r\n       }\r\n \r\n       // 检查用户的所有角色中是否有包含所需权限的\r\n-      return user.Roles.some((role) =>\r\n-        role.Permissions.some(\r\n+      return user.roles.some((role) =>\r\n+        role.permissions.some(\r\n           (permission) => permission.name === requiredPermission\r\n         )\r\n       );\r\n     } catch (error) {\r\n"
                }
            ],
            "date": 1745881501039,
            "name": "Commit-0",
            "content": "const { User, Role, Permission } = require(\"../models\");\r\n\r\nclass RBACService {\r\n  async checkPermission(userId, requiredPermission) {\r\n    try {\r\n      // 获取用户及其角色和权限\r\n      const user = await User.findByPk(userId, {\r\n        include: [{\r\n          model: Role,\r\n          include: [{\r\n            model: Permission\r\n          }]\r\n        }]\r\n      });\r\n\r\n      if (!user) {\r\n        return false;\r\n      }\r\n\r\n      // 检查用户的所有角色中是否有包含所需权限的\r\n      return user.Roles.some(role => \r\n        role.Permissions.some(permission => permission.name === requiredPermission)\r\n      );\r\n    } catch (error) {\r\n      console.error(\"Error checking permission:\", error);\r\n      return false;\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = new RBACService(); \r\n"
        }
    ]
}