{
    "sourceFile": "seeders/init.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1745880408862,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1745880408862,
            "name": "Commit-0",
            "content": "const bcrypt = require('bcryptjs');\r\nconst { User, Role, Permission } = require('../models');\r\n\r\nasync function createInitialData() {\r\n  try {\r\n    // 1. 创建权限\r\n    const permissions = await Permission.bulkCreate([\r\n      { name: 'create_user', action: 'create', resource: 'user', description: '创建用户' },\r\n      { name: 'view_users', action: 'read', resource: 'user', description: '查看用户' },\r\n      { name: 'update_user', action: 'update', resource: 'user', description: '更新用户' },\r\n      { name: 'delete_user', action: 'delete', resource: 'user', description: '删除用户' },\r\n      { name: 'manage_roles', action: 'manage', resource: 'role', description: '管理角色' },\r\n      { name: 'manage_categories', action: 'manage', resource: 'category', description: '管理分类' }\r\n    ]);\r\n\r\n    // 2. 创建角色\r\n    const adminRole = await Role.create({\r\n      name: 'admin',\r\n      description: '系统管理员'\r\n    });\r\n\r\n    const userRole = await Role.create({\r\n      name: 'user',\r\n      description: '普通用户'\r\n    });\r\n\r\n    // 3. 为角色分配权限\r\n    // 管理员拥有所有权限\r\n    await adminRole.setPermissions(permissions);\r\n    // 普通用户只有查看权限\r\n    await userRole.setPermissions(\r\n      permissions.filter(p => p.name === 'view_users')\r\n    );\r\n\r\n    // 4. 创建管理员用户\r\n    const adminUser = await User.create({\r\n      username: 'admin',\r\n      password: 'admin123', // 会自动加密\r\n      email: 'admin@example.com',\r\n      status: true\r\n    });\r\n\r\n    // 5. 为管理员分配角色\r\n    await adminUser.setRoles([adminRole.id]);\r\n\r\n    console.log('Initial data created successfully!');\r\n    return { adminUser, adminRole, userRole, permissions };\r\n  } catch (error) {\r\n    console.error('Error creating initial data:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\nmodule.exports = createInitialData;"
        }
    ]
}